; ============================================================================
; PlatformIO Configuration for Unified UI Controller (ESP32)
; All display modules, wipers, WiFi, etc. unified in one firmware
; ============================================================================

[platformio]
default_envs = esp32dev

; ============================================================================
; ESP32 WROOM-32 (most common)
; ============================================================================
[env:esp32dev]
platform = espressif32 @ ^6.0.0
board = esp32dev
framework = arduino

board_build.mcu = esp32
board_build.f_cpu = 240000000L
board_build.f_flash = 40000000L
board_build.flash_mode = dio
board_build.partitions = default.csv

lib_deps =
    adafruit/Adafruit SSD1306 @ ^2.5.7        ; OLED displays
    adafruit/Adafruit GFX Library @ ^1.11.9   ; Graphics library
    adafruit/RTClib @ ^2.1.1                  ; RTC for AC display
    mathertel/RotaryEncoder @ ^1.5.3          ; Rotary encoders
    bblanchon/ArduinoJson @ ^6.21.3           ; JSON for web dashboard
    me-no-dev/AsyncTCP @ ^1.1.1               ; Async web server
    me-no-dev/ESPAsyncWebServer @ ^1.2.3      ; Web dashboard
    https://github.com/sandeepmistry/arduino-CAN.git  ; CAN (if using CAN bridge)

build_flags =
    -D ENABLE_SERIAL_DEBUG=1
    -D ARDUINO_ARCH_ESP32
    -D CONFIG_FREERTOS_HZ=1000
    -Wall
    -Wextra

upload_protocol = esptool
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Enable OTA updates
upload_port = COM5              ; Change to your port
;upload_port = rx8-ecu.local    ; OTA upload (if WiFi configured)

; ============================================================================
; ESP32-S3 (newer, better peripherals)
; ============================================================================
[env:esp32s3]
platform = espressif32 @ ^6.0.0
board = esp32-s3-devkitc-1
framework = arduino

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

lib_deps =
    ${env:esp32dev.lib_deps}

build_flags =
    ${env:esp32dev.build_flags}
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1

upload_protocol = esptool
upload_speed = 921600
monitor_speed = 115200

; ============================================================================
; ESP32-C3 (RISC-V, cheaper)
; ============================================================================
[env:esp32c3]
platform = espressif32 @ ^6.0.0
board = esp32-c3-devkitm-1
framework = arduino

board_build.mcu = esp32c3
board_build.f_cpu = 160000000L

lib_deps =
    ${env:esp32dev.lib_deps}

build_flags =
    ${env:esp32dev.build_flags}
    -D ARDUINO_USB_MODE=1

upload_protocol = esptool
upload_speed = 921600
monitor_speed = 115200
